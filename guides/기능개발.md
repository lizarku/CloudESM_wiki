# 3. 기능개발

> **CloudESM SOAR 플랫폼 신규 기능 개발 가이드**

[← 통합매뉴얼로 돌아가기](../통합매뉴얼.md)

---

## 목차

### 1. [개발 환경 설정](#개발-환경-설정)
- [필수 도구](#필수-도구)
- [IDE 설정](#ide-설정)
- [Java 프로젝트 구조](#java-프로젝트-구조)
- [Git 사용 규칙](#git-사용-규칙)
- [파일 변경 반영 규칙](#파일-변경-반영-규칙)
- [디렉토리 구조](#디렉토리-구조)
- [개발 도구 및 확장](#개발-도구-및-확장)
- [개발 모범 사례](#개발-모범-사례)

### 2. [메뉴 시스템 개발](#메뉴-시스템-개발)
- [메뉴 구조 이해](#메뉴-구조-이해)
- [메뉴 및 화면 추가](#메뉴-및-화면-추가)
- [메뉴 데이터베이스](#메뉴-데이터베이스)

### 3. [Spring MVC 패턴](#spring-mvc-패턴)
- [Controller 작성법](#controller-작성법)
- [Service 레이어](#service-레이어)
- [MyBatis 매퍼](#mybatis-매퍼)
- [데이터 전달 방식 (Map 기반)](#데이터-전달-방식-map-기반)

### 4. [프론트엔드 개발](#프론트엔드-개발)
- [JSP 페이지 작성](#jsp-페이지-작성)
- [JavaScript 구조](#javascript-구조)
- [Toast UI Grid](#toast-ui-grid)
- [API 호출](#api-호출)
- [eyeCloudXOAR JavaScript 프레임워크](#eyecloudxoar-javascript-프레임워크)

### 5. [데이터베이스 개발](#데이터베이스-개발)
- [테이블 설계 규칙](#테이블-설계-규칙)
- [SQL 작성 가이드](#sql-작성-가이드)
- [인덱스 전략](#인덱스-전략)

### 6. [기능별 개발 사례](#기능별-개발-사례)
- [사이버 복원력 정량 지표](#사이버-복원력-정량-지표)

---

## 개발 환경 설정

### 필수 도구

| 도구 | 버전 | 용도 |
|------|------|------|
| Java JDK | Zulu 11 | 백엔드 개발 |
| IDE | IntelliJ IDEA / Eclipse | 코드 편집 |
| Git | 최신 | 버전 관리 |
| Maven | 3.6+ | 빌드 도구 (선택) |
| WSL2 | Ubuntu 24.04 | 운영 환경 |

### IDE 설정

#### IntelliJ IDEA 설정

1. **프로젝트 열기**: `/CloudESM/app/www/ROOT` 디렉토리
2. **JDK 설정**: Project Structure → SDKs → Zulu 11
3. **인코딩 설정**: UTF-8
4. **Tomcat 연동**: Run → Edit Configurations → Tomcat Server

#### Eclipse 설정

1. **프로젝트 Import**: Dynamic Web Project
2. **Build Path**: Java JDK 11 추가
3. **Server Runtime**: Tomcat 9 추가

### Java 프로젝트 구조

```
/CloudESM/app/www/ROOT/
├── WEB-INF/
│   ├── classes/              # 컴파일된 Java 클래스
│   │   └── com/seculayer/web/
│   │       ├── common/       # 공통 유틸리티
│   │       ├── auth/         # 인증/권한
│   │       ├── soar/         # SOAR 기능
│   │       ├── event/        # 이벤트 관리
│   │       └── [module]/     # 기능별 모듈
│   │           ├── controller/  # Spring Controller
│   │           ├── service/     # 비즈니스 로직
│   │           ├── dao/         # DAO Interface
│   │           ├── mapper/      # MyBatis XML
│   │           └── model/       # VO/DTO
│   │
│   ├── jsp/                  # JSP 뷰 파일
│   │   ├── common/           # 공통 JSP
│   │   └── [module]/         # 기능별 JSP
│   │
│   ├── lib/                  # JAR 라이브러리
│   ├── web.xml               # 웹 애플리케이션 설정
│   └── servlet-context.xml   # Spring MVC 설정
│
└── resources/                # 정적 리소스
    ├── js/                   # JavaScript
    ├── css/                  # CSS
    └── img/                  # 이미지
```

---

### 파일 변경 반영 규칙

> **Grunt 빌드 없이** 톰캣 서버에 바로 반영하는 방법

#### 파일 유형별 반영 방식

| 파일 유형 | 복사만 하면 반영 | 컴파일 필요 | 톰캣 재시작 필요 |
|-----------|:---------------:|:-----------:|:---------------:|
| JSP | ✅ | ❌ | ❌ |
| JS | ✅ | ❌ | ❌ |
| CSS | ✅ | ❌ | ❌ |
| Java | ✅ | ✅ (`javac`) | ❌ (`touch web.xml`) |
| XML Mapper | ✅ | ❌ | ❌ |

#### 복사 경로

| 파일 유형 | 소스 경로 | 배포 경로 (복사 대상) |
|-----------|-----------|----------------------|
| JSP | `src/main/webapp/WEB-INF/jsp/` | `app/www/ROOT/WEB-INF/jsp/` |
| JS | `src/main/frontend/src/app/` | `app/www/ROOT/resources/app/` |
| CSS | `src/main/frontend/src/css/` | `app/www/ROOT/resources/css/` |

#### 복사 명령 예시

```bash
# JSP 복사
cp src/main/webapp/WEB-INF/jsp/soar/cyberResilience/cyber_resilience_list.jsp \
   app/www/ROOT/WEB-INF/jsp/soar/cyberResilience/

# JS 복사
cp src/main/frontend/src/app/soar/cyberResilience/cyber_resilience_list.js \
   app/www/ROOT/resources/app/soar/cyberResilience/

# CSS 복사
cp src/main/frontend/src/css/style.css \
   app/www/ROOT/resources/css/
```

#### 브라우저 캐시 처리

정적 파일(JS, CSS)은 브라우저에 캐시되므로, 변경 사항을 확인하려면 캐시를 비워야 합니다.

| 방법 | 설명 | 단축키 |
|------|------|--------|
| **강력 새로고침** | 현재 페이지의 캐시만 무시하고 새로고침 | `Ctrl + Shift + R` (Windows) / `Cmd + Shift + R` (Mac) |
| **캐시 비활성화** | 개발자 도구 열린 동안 모든 캐시 비활성화 | `F12` → Network 탭 → ☑️ "Disable cache" 체크 |

> ⚠️ **주의**: "Disable cache" 옵션은 **개발자 도구가 열려 있을 때만** 작동합니다.

#### 배포 폴더 직접 수정

개발 중에는 배포 폴더에서 직접 수정하면 복사 과정 없이 바로 반영됩니다:

```
# JSP 직접 수정
app/www/ROOT/WEB-INF/jsp/soar/cyberResilience/cyber_resilience_list.jsp

# JS 직접 수정
app/www/ROOT/resources/app/soar/cyberResilience/cyber_resilience_list.js

# CSS 직접 수정
app/www/ROOT/resources/css/style.css
```

---

## API 호출

> ⚠️ **중요**: 이 프로젝트는 보안상의 이유로 **모든 API 호출에 POST 방식과 `requestData()` 메서드**를 사용합니다.

### 표준 패턴: `$("body").requestData()`

**CUD (생성/수정/삭제) 및 민감 데이터 조회**

```javascript
// 저장 요청
var params = {
    slKey: $("#slKey").val() || "",  // ⚠️ 필수: CSRF 토큰
    playbook_id: playbookId,
    indicator_ids: selectedIds       // 배열도 자동 직렬화
};

$("body").requestData(config.urlMappingSave, params, {
    displayLoader: true,
    callback: function(data, result_cd, result_msg) {
        if (result_cd && result_cd.indexOf("SUC") !== -1) {
            _alert(result_msg || "저장되었습니다.");
        } else {
            _alert(result_msg || "처리에 실패했습니다.");
        }
    }
});
```

**삭제 요청 (확인창 포함)**

```javascript
_confirm("삭제하시겠습니까?", {
    onAgree: function() {
        var params = {
            slKey: $("#slKey").val() || "",
            eval_result_id: evalResultId
        };

        $("body").requestData(config.urlDelete, params, {
            displayLoader: true,
            callback: function(data, result_cd, result_msg) {
                if (result_cd && result_cd.indexOf("SUC") !== -1) {
                    _alert(result_msg);
                    loadList();  // 목록 갱신
                }
            }
        });
    }
});
```

### 조회 전용 (비민감 데이터)

정적 리소스나 비민감 조회는 `$.ajax()` GET 사용 가능:

```javascript
// 정적 JSON 파일 로드
$.ajax({
    type: "GET",
    url: gCONTEXT_PATH + "resources/data/config.json",
    dataType: "json",
    success: function(response) {
        // 처리
    }
});
```

### 핵심 규칙

| 요청 유형 | 메서드 | slKey | 비고 |
|-----------|--------|-------|------|
| 생성/수정/삭제 | `$("body").requestData()` | **필수** | `.do` 엔드포인트 |
| 민감 데이터 조회 | `$("body").requestData()` | **필수** | 사용자 정보 등 |
| 비민감 조회 | `$.ajax({ type: "GET" })` | 불필요 | `.json` 엔드포인트 |
| 정적 리소스 | `$.ajax({ type: "GET" })` | 불필요 | 설정 파일 등 |

### ❌ 금지 패턴

```javascript
// ❌ WRONG - 403 Forbidden 에러 발생
$.ajax({
    type: "POST",  // POST를 $.ajax로 직접 호출
    url: config.urlSave,
    contentType: "application/json",
    data: JSON.stringify({ ... }),
    ...
});

// ❌ WRONG - native 함수 사용 금지
alert("메시지");     // → _alert() 사용
confirm("확인?");   // → _confirm() 사용
```

---

[← 통합매뉴얼로 돌아가기](../통합매뉴얼.md)

**작성일**: 2025-12-19 | **버전**: 1.2
